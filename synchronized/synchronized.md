## 并发安全问题

多线程编程中，有可能会出现多个线程同时访问同一个共享、可变资源的情况，这个资源我们称之其为临界资源；这种资源可能是：对象、变量、文件等。 

- 共享：资源可以由多个线程同时访问 

- 可变：资源可以在其生命周期内被修改

由于线程执行的过程是不可控的，所以需要采用同步机制来协同对对象可变状态的访问，实际上，所有的并发模式在解决线程安全问题时，采用的方案都是**序列化**访问临界资源。即在同一时刻，只能有一个线程访问临界资源也称作**同步互斥访问**。

> Java中提供了两种实现同步互斥访问的方式：`synchronized`和`Lock`

## `synchronized`原理详解

synchronized内置锁是一种可重入的对象锁

加锁方式：

- 非静态方法加锁，锁的是当前实例对象
- 同步代码块加锁，锁的是括号内的对象（可以是实列对象，或者类对象）
- 静态方法加锁，锁的是该方法的类对象

### 底层原理

synchronized是基于`JVM`内置锁实现，通过内部对象Monitor(监视器锁)实现，基于进入与退出Monitor对象实现方法与代码块同步，监视器锁的实现依赖底层操作系统的`Mutex lock（互斥锁）`实现，它是一个重量级锁性能较低。当然，`JVM`内置锁在1.5之后版本做了重大的优化，如锁粗化（Lock Coarsening）、锁消除（Lock Elimination）、轻量级锁（Lightweight Locking）、偏向锁（Biased Locking）、适应性自旋（Adaptive Spinning）等技术来减少锁操作的开销，内置锁的并发性能已经基本与Lock持平。 